{"ast":null,"code":"import{ethers}from\"ethers\";import{useContext}from\"react\";import{GlobalState}from\"../global_states/global_state\";import{handleEthAccReq}from\"../functions/handleEthAccReq\";import erc20abi from\"../../ERC20abi.json\";import{jsx as _jsx}from\"react/jsx-runtime\";export function UpdateUser(prop){const{currentUserInfo,setCurrentUserInfo,accReqPending,setAccReqPending}=useContext(GlobalState);const contractAddress=currentUserInfo.contractAddress;var provider=currentUserInfo.provider;var signer=currentUserInfo.signer;var signerAddress=currentUserInfo.signerAddress;var erc20=currentUserInfo.erc20;const updateUser=async()=>{try{if(!window.ethereum)throw new Error('No crypto wallet found. Please install \"MetaMask\" in the Chrome Extensions Store');}catch(err){alert(err);}provider=new ethers.providers.Web3Provider(window.ethereum,\"any\");if(accReqPending===null){setAccReqPending(true);}const _ethReqP=await handleEthAccReq();if(!_ethReqP){sessionStorage.setItem(accReqPending,true);setAccReqPending(true);}else{signer=provider.getSigner();signerAddress=await signer.getAddress().catch(e=>console.log(e));erc20=new ethers.Contract(contractAddress,erc20abi,signer);sessionStorage.setItem(accReqPending,false);setAccReqPending(false);setCurrentUserInfo(prev=>{return{...prev,provider,signer,signerAddress,erc20};});}};if(prop.prop==\"connect\"){return/*#__PURE__*/_jsx(\"button\",{className:\"button\",onClick:()=>updateUser(),children:\"Connect\"});}else if(prop.prop==\"retry\"){return/*#__PURE__*/_jsx(\"button\",{className:\"button\",onClick:()=>updateUser(),children:\"Retry\"});}else{return/*#__PURE__*/_jsx(\"button\",{className:\"button\",onClick:()=>updateUser(),children:\"!Error\"});}}","map":{"version":3,"names":["ethers","useContext","GlobalState","handleEthAccReq","erc20abi","jsx","_jsx","UpdateUser","prop","currentUserInfo","setCurrentUserInfo","accReqPending","setAccReqPending","contractAddress","provider","signer","signerAddress","erc20","updateUser","window","ethereum","Error","err","alert","providers","Web3Provider","_ethReqP","sessionStorage","setItem","getSigner","getAddress","catch","e","console","log","Contract","prev","className","onClick","children"],"sources":["C:/Users/Brandon/Projects/3x3-monte-dapp/src/components/buttons/updateUser.js"],"sourcesContent":["import { ethers } from \"ethers\"\r\nimport { useContext } from \"react\";\r\nimport { GlobalState } from \"../global_states/global_state\";\r\nimport { handleEthAccReq } from \"../functions/handleEthAccReq\";\r\nimport erc20abi from \"../../ERC20abi.json\"\r\n\r\nexport function UpdateUser(prop) {\r\n    const { currentUserInfo, setCurrentUserInfo, accReqPending, setAccReqPending } = useContext(GlobalState);\r\n    const contractAddress = currentUserInfo.contractAddress;\r\n    var provider = currentUserInfo.provider;\r\n    var signer = currentUserInfo.signer;\r\n    var signerAddress = currentUserInfo.signerAddress;\r\n    var erc20 = currentUserInfo.erc20;\r\n    const updateUser = async () => {\r\n        try {\r\n            if (!window.ethereum)\r\n                throw new Error('No crypto wallet found. Please install \"MetaMask\" in the Chrome Extensions Store')\r\n        } catch (err) {\r\n            alert(err)\r\n        }\r\n        provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\r\n        if (accReqPending === null) {\r\n            setAccReqPending(true);\r\n        }\r\n        const _ethReqP = await handleEthAccReq();\r\n        if (!_ethReqP) {\r\n            sessionStorage.setItem(accReqPending, true);\r\n            setAccReqPending(true);\r\n        } else {\r\n            signer = provider.getSigner();\r\n            signerAddress = await signer.getAddress().catch(e => console.log(e));\r\n            erc20 = new ethers.Contract(contractAddress, erc20abi, signer);\r\n            sessionStorage.setItem(accReqPending, false);\r\n            setAccReqPending(false);\r\n            setCurrentUserInfo(prev => {\r\n                    return {\r\n                        ...prev,\r\n                        provider,\r\n                        signer,\r\n                        signerAddress,\r\n                        erc20\r\n                    }\r\n                });\r\n        }\r\n\r\n    }\r\n    if (prop.prop == \"connect\") {\r\n        return (\r\n            <button className=\"button\" onClick={() => updateUser()}>Connect</button>\r\n        )\r\n    }\r\n    else if (prop.prop == \"retry\") {\r\n        return (\r\n            <button className=\"button\" onClick={() => updateUser()}>Retry</button>\r\n        )\r\n    }\r\n    else {\r\n        return (\r\n            <button className=\"button\" onClick={() => updateUser()}>!Error</button>\r\n        )\r\n    }\r\n}"],"mappings":"AAAA,OAASA,MAAM,KAAQ,QAAQ,CAC/B,OAASC,UAAU,KAAQ,OAAO,CAClC,OAASC,WAAW,KAAQ,+BAA+B,CAC3D,OAASC,eAAe,KAAQ,8BAA8B,CAC9D,MAAO,CAAAC,QAAQ,KAAM,qBAAqB,QAAAC,GAAA,IAAAC,IAAA,yBAE1C,MAAO,SAAS,CAAAC,UAAUA,CAACC,IAAI,CAAE,CAC7B,KAAM,CAAEC,eAAe,CAAEC,kBAAkB,CAAEC,aAAa,CAAEC,gBAAiB,CAAC,CAAGX,UAAU,CAACC,WAAW,CAAC,CACxG,KAAM,CAAAW,eAAe,CAAGJ,eAAe,CAACI,eAAe,CACvD,GAAI,CAAAC,QAAQ,CAAGL,eAAe,CAACK,QAAQ,CACvC,GAAI,CAAAC,MAAM,CAAGN,eAAe,CAACM,MAAM,CACnC,GAAI,CAAAC,aAAa,CAAGP,eAAe,CAACO,aAAa,CACjD,GAAI,CAAAC,KAAK,CAAGR,eAAe,CAACQ,KAAK,CACjC,KAAM,CAAAC,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC3B,GAAI,CACA,GAAI,CAACC,MAAM,CAACC,QAAQ,CAChB,KAAM,IAAI,CAAAC,KAAK,CAAC,kFAAkF,CAAC,CAC3G,CAAE,MAAOC,GAAG,CAAE,CACVC,KAAK,CAACD,GAAG,CAAC,CACd,CACAR,QAAQ,CAAG,GAAI,CAAAd,MAAM,CAACwB,SAAS,CAACC,YAAY,CAACN,MAAM,CAACC,QAAQ,CAAE,KAAK,CAAC,CACpE,GAAIT,aAAa,GAAK,IAAI,CAAE,CACxBC,gBAAgB,CAAC,IAAI,CAAC,CAC1B,CACA,KAAM,CAAAc,QAAQ,CAAG,KAAM,CAAAvB,eAAe,CAAC,CAAC,CACxC,GAAI,CAACuB,QAAQ,CAAE,CACXC,cAAc,CAACC,OAAO,CAACjB,aAAa,CAAE,IAAI,CAAC,CAC3CC,gBAAgB,CAAC,IAAI,CAAC,CAC1B,CAAC,IAAM,CACHG,MAAM,CAAGD,QAAQ,CAACe,SAAS,CAAC,CAAC,CAC7Bb,aAAa,CAAG,KAAM,CAAAD,MAAM,CAACe,UAAU,CAAC,CAAC,CAACC,KAAK,CAACC,CAAC,EAAIC,OAAO,CAACC,GAAG,CAACF,CAAC,CAAC,CAAC,CACpEf,KAAK,CAAG,GAAI,CAAAjB,MAAM,CAACmC,QAAQ,CAACtB,eAAe,CAAET,QAAQ,CAAEW,MAAM,CAAC,CAC9DY,cAAc,CAACC,OAAO,CAACjB,aAAa,CAAE,KAAK,CAAC,CAC5CC,gBAAgB,CAAC,KAAK,CAAC,CACvBF,kBAAkB,CAAC0B,IAAI,EAAI,CACnB,MAAO,CACH,GAAGA,IAAI,CACPtB,QAAQ,CACRC,MAAM,CACNC,aAAa,CACbC,KACJ,CAAC,CACL,CAAC,CAAC,CACV,CAEJ,CAAC,CACD,GAAIT,IAAI,CAACA,IAAI,EAAI,SAAS,CAAE,CACxB,mBACIF,IAAA,WAAQ+B,SAAS,CAAC,QAAQ,CAACC,OAAO,CAAEA,CAAA,GAAMpB,UAAU,CAAC,CAAE,CAAAqB,QAAA,CAAC,SAAO,CAAQ,CAAC,CAEhF,CAAC,IACI,IAAI/B,IAAI,CAACA,IAAI,EAAI,OAAO,CAAE,CAC3B,mBACIF,IAAA,WAAQ+B,SAAS,CAAC,QAAQ,CAACC,OAAO,CAAEA,CAAA,GAAMpB,UAAU,CAAC,CAAE,CAAAqB,QAAA,CAAC,OAAK,CAAQ,CAAC,CAE9E,CAAC,IACI,CACD,mBACIjC,IAAA,WAAQ+B,SAAS,CAAC,QAAQ,CAACC,OAAO,CAAEA,CAAA,GAAMpB,UAAU,CAAC,CAAE,CAAAqB,QAAA,CAAC,QAAM,CAAQ,CAAC,CAE/E,CACJ","ignoreList":[]},"metadata":{},"sourceType":"module"}